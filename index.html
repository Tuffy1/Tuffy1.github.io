<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="写字的地方">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="写字的地方">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="写字的地方">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/">





  <title>写字的地方</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">写字的地方</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/12/es6-generator/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="J.Y.">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="写字的地方">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/12/es6-generator/" itemprop="url">es6 Generator</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-01-12T15:34:30+08:00">
                2020-01-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Generator-生成器"><a href="#Generator-生成器" class="headerlink" title="Generator 生成器"></a>Generator 生成器</h2><p>Generator 函数包含一组状态，调用它时返回一个 Iterator 迭代器对象，通过 Iterator 执行并一步一步读取 Generator 中的状态。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> ite = gen();</span><br><span class="line">ite.next(); <span class="comment">// 开始执行 gen 函数体内的语句，返回第一个状态 &#123; value: 1, done: false &#125;</span></span><br><span class="line">ite.next(); <span class="comment">// 返回第二个状态 &#123; value: 2, done: false &#125;</span></span><br><span class="line">ite.next(); <span class="comment">// 返回第三个状态 &#123; value: 3, done: false &#125;</span></span><br><span class="line">ite.next(); <span class="comment">// 返回第四个状态 &#123; value: undefined, done: true &#125;</span></span><br></pre></td></tr></table></figure>
<p><code>ite = gen()</code> 语句时并没有开始执行 gen 函数中的内容，而是直接返回了一个 Iterator。在第一个 <code>ite.next()</code> 时，才开始真正执行，并在遇到第一次 yield 时停止，以 <code>{ value: 1, done: false }</code> 的形式返回第一个 yield 表达式产生的值。value 是对应的值，done 表示是否结束，当函数执行完毕，或者遇到 return 时，done 为 true。</p>
<h2 id="Symbol-iterator-与-for…of"><a href="#Symbol-iterator-与-for…of" class="headerlink" title="Symbol.iterator 与 for…of"></a>Symbol.iterator 与 for…of</h2><p>一些数据格式自带 Symbol.iterator 方法，比如 Array，Map，Set, NodeList 等，执行该方法可以得到一个 Iterator 对象，以数组为例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">11</span>, <span class="number">2</span>, <span class="number">33</span>, <span class="number">4</span>];</span><br><span class="line"><span class="keyword">let</span> ite = arr[<span class="built_in">Symbol</span>.iterator]();</span><br><span class="line">ite.next(); <span class="comment">// &#123; value: 11, done: false &#125;</span></span><br><span class="line">ite.next(); <span class="comment">// &#123; value: 2, done: false &#125;</span></span><br><span class="line">ite.next(); <span class="comment">// &#123; value: 33, done: false &#125;</span></span><br><span class="line">ite.next(); <span class="comment">// &#123; value: 4, done: false &#125;</span></span><br><span class="line">ite.next(); <span class="comment">// &#123; value: undefined, done: true &#125;</span></span><br></pre></td></tr></table></figure>
<p>可以看到，通过调用数组的 Symbol.iterator 方法，得到的 ite，<code>ite.next()</code> 方法迭代读取的是数组的每个元素，这也是 for…of 的实现原理，通过对象的 Symbol.iterator 方法来获取每一步值。<br>假设我们重新实现以下 arr 的 Symbol.iterator 方法，再执行以下 for…of</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">11</span>, <span class="number">2</span>, <span class="number">33</span>, <span class="number">4</span>];</span><br><span class="line">arr[<span class="built_in">Symbol</span>.iterator] = <span class="function"><span class="keyword">function</span>*(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">"arr yield 1"</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">"arr yield 2"</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">"arr yield 3"</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> arr) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arr yield 1</span><br><span class="line">arr yield 2</span><br><span class="line">arr yield 3</span><br></pre></td></tr></table></figure>
<p>与 for…of 同样的，解构赋值，扩展与 Array.from 方法也是调用的 Iterator 接口：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">"a"</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">"b"</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">"c"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> ite = gen();</span><br><span class="line">[...ite]; <span class="comment">// ['a', 'b', 'c']</span></span><br><span class="line">ite = gen(); <span class="comment">// 注意这里不能直接使用ite，因为此时ite已经走完了处于close。要重新执行</span></span><br><span class="line"><span class="keyword">let</span> [x, y, z] = ite; <span class="comment">// x: 'a', y: 'b', z: 'c'</span></span><br></pre></td></tr></table></figure>
<h2 id="next-方法参数"><a href="#next-方法参数" class="headerlink" title="next 方法参数"></a>next 方法参数</h2><p>当调用 next 方法时，可以往其中传参数，这个参数作为上一次状态的返回值。举个例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> res1, res2, res3;</span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  x = <span class="keyword">yield</span> <span class="string">"a"</span>;</span><br><span class="line">  y = <span class="keyword">yield</span> <span class="string">`<span class="subst">$&#123;x&#125;</span>b`</span>;</span><br><span class="line">  <span class="keyword">yield</span> z;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> ite = gen();</span><br><span class="line">res1 = ite.next(); <span class="comment">// 第一步不传参，第一步传参的话无意义，因为这已经是第一个状态，不存在它的上一个状态</span></span><br><span class="line">res2 = ite.next(res1.value); <span class="comment">// 此时将 res1.value 为'a'，并将它传给了 x，得到 res2 为 'ab'</span></span><br><span class="line">res3 = ite.next(res2.value); <span class="comment">// 此时将 res2.value 为'ab'，并将它传给了 y，得到 res3 为'abc'</span></span><br></pre></td></tr></table></figure>
<h2 id="Generator-与异步"><a href="#Generator-与异步" class="headerlink" title="Generator 与异步"></a>Generator 与异步</h2><h3 id="自动执行-Generator：then-方法"><a href="#自动执行-Generator：then-方法" class="headerlink" title="自动执行 Generator：then 方法"></a>自动执行 Generator：then 方法</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fetch = <span class="built_in">require</span>(<span class="string">"node-fetch"</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> data = <span class="keyword">yield</span> fetch(<span class="string">"https://api.github.com/users/github"</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(data);</span><br><span class="line">  <span class="keyword">let</span> json = <span class="keyword">yield</span> data.json();</span><br><span class="line">  <span class="built_in">console</span>.log(json);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params">gen</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> ite = gen();</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">next</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> res = ite.next(data);</span><br><span class="line">    <span class="keyword">if</span> (res.done) <span class="keyword">return</span> res.value;</span><br><span class="line">    res.value.then(<span class="function"><span class="params">d</span> =&gt;</span> &#123;</span><br><span class="line">      next(d);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  next();</span><br><span class="line">&#125;</span><br><span class="line">run(gen);</span><br></pre></td></tr></table></figure>
<p>但这要求 res.value 需要是 Promise 对象，所以可以尝试对 res.value 进行 promisify，以帮助我们在 then 中调用 next 取回 gen 的执行权。此外我们还可以让 <code>run(gen)</code> 的返回值为 Promise 对象，这样可以进一步进行我们想要的异步操作，所以我们可以 new Promise 在其外面包装一层。同时添加一些错误处理：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fetch = <span class="built_in">require</span>(<span class="string">"node-fetch"</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> data = <span class="keyword">yield</span> fetch(<span class="string">"https://api.github.com/users/github"</span>);</span><br><span class="line">  <span class="keyword">let</span> json = <span class="keyword">yield</span> data.json();</span><br><span class="line">  <span class="built_in">console</span>.log(json);</span><br><span class="line">  <span class="keyword">let</span> email = <span class="keyword">yield</span> json.email;</span><br><span class="line">  <span class="built_in">console</span>.log(email);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params">gen</span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">onFulfilled</span>(<span class="params">v</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      next(v);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">return</span> reject(e);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">onRejected</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      gen.throw(err);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">return</span> reject(e);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!gen || <span class="keyword">typeof</span> gen !== <span class="string">"function"</span>) <span class="keyword">return</span> resolve(gen);</span><br><span class="line">    <span class="keyword">let</span> ite = gen();</span><br><span class="line">    <span class="keyword">if</span> (!ite || <span class="keyword">typeof</span> ite.next !== <span class="string">"function"</span>) <span class="keyword">return</span> resolve(gen);</span><br><span class="line">    next();</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">next</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">let</span> res = ite.next(data);</span><br><span class="line">      <span class="keyword">if</span> (res.done) <span class="keyword">return</span> resolve(res.value);</span><br><span class="line">      <span class="keyword">let</span> value = toPromise(res.value);</span><br><span class="line">      <span class="keyword">if</span> (value &amp;&amp; isPromise(value)) <span class="keyword">return</span> value.then(onFulfilled, onRejected);</span><br><span class="line">      <span class="keyword">return</span> onRejected(</span><br><span class="line">        <span class="keyword">new</span> <span class="built_in">TypeError</span>(</span><br><span class="line">          <span class="string">"You may only yield a function, promise, generator, array, or object, "</span> +</span><br><span class="line">            <span class="string">'but the following object was passed: "'</span> +</span><br><span class="line">            <span class="built_in">String</span>(ret.value) +</span><br><span class="line">            <span class="string">'"'</span></span><br><span class="line">        )</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line">run(gen).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;);</span><br></pre></td></tr></table></figure>
<p>事实上，上面的核心代码来源一个模块 <a href="https://github.com/tj/co" target="_blank" rel="noopener">co</a>，一个帮助 Generator 函数自动执行的库。通过递归地在 <code>then</code> 中执行 <code>ite.next</code> 来达到当前异步操作执行完毕后就取回执行权的目的。</p>
<h3 id="自动执行-Generator：thunk"><a href="#自动执行-Generator：thunk" class="headerlink" title="自动执行 Generator：thunk"></a>自动执行 Generator：thunk</h3><p>关于 thunk 是什么，文章 <a href="http://www.ruanyifeng.com/blog/2015/05/thunk.html" target="_blank" rel="noopener">阮一峰 Thunk 函数的含义和用法</a> 对此有清晰的解释。总的来说，讲一个函数转为 thunk 函数有以下的效果：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"><span class="keyword">let</span> thunkify = <span class="built_in">require</span>(<span class="string">"thunkify"</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cb</span>(<span class="params">err, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(err);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> readFile = fs.readFile;</span><br><span class="line">readFile(<span class="string">"./package.json"</span>, cb);</span><br><span class="line"><span class="keyword">let</span> thunkReadFile = thunkify(readFile)(<span class="string">"./package.json"</span>); <span class="comment">// thunkify</span></span><br><span class="line">thunkReadFile(cb);</span><br></pre></td></tr></table></figure>
<p>对比 <code>readFile(&quot;./package.json&quot;, cb)</code> 和 <code>thunkReadFile(&quot;./package.json&quot;)(cb)</code>，第一个函数调用是多参数的，而第二个可以<strong>将回调函数作为一个单独的参数</strong>。Thunk 转换的主要思路：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> thunkify = <span class="function"><span class="params">fn</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> args = [...arguments];</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">      args.push(callback);</span><br><span class="line">      <span class="keyword">return</span> fn.apply(<span class="keyword">this</span>, args);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>利用这一点，我们将 <code>ite.next</code> 这一步放在回调函数中，作为参数，使执行权回到 gen 函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"><span class="keyword">let</span> thunkify = <span class="built_in">require</span>(<span class="string">"thunkify"</span>);</span><br><span class="line"><span class="keyword">let</span> readFile = fs.readFile;</span><br><span class="line"><span class="keyword">let</span> thunkReadFile = thunkify(readFile);</span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> pk = <span class="keyword">yield</span> thunkReadFile(<span class="string">"./package.json"</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(pk);</span><br><span class="line">  <span class="keyword">let</span> pkl = <span class="keyword">yield</span> thunkReadFile(<span class="string">"./package-lock.json"</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(pkl);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> ite = gen();</span><br><span class="line"><span class="keyword">let</span> res = ite.next();</span><br><span class="line">res.value(<span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// thunkReadFile("./package.json") 执行完毕后，将下一步操作作为回调</span></span><br><span class="line">  res = ite.next(data);</span><br><span class="line">  res.value(<span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">    res = ite.next(data);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>通过将异步操作 thunkify，执行之后将下一步操作放在其 value（实际为一个 function）的参数执行。可以通过递归来使上面的调用更加普遍适用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"><span class="keyword">let</span> thunkify = <span class="built_in">require</span>(<span class="string">"thunkify"</span>);</span><br><span class="line"><span class="keyword">let</span> readFile = fs.readFile;</span><br><span class="line"><span class="keyword">let</span> thunkReadFile = thunkify(readFile);</span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> pk = <span class="keyword">yield</span> thunkReadFile(<span class="string">"./package.json"</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(pk);</span><br><span class="line">  <span class="keyword">let</span> pkl = <span class="keyword">yield</span> thunkReadFile(<span class="string">"./package-lock.json"</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(pkl);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">next</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> res = ite.next(data);</span><br><span class="line">  <span class="keyword">if</span> (res.done) <span class="keyword">return</span>; <span class="comment">// 判断结束</span></span><br><span class="line">  res.value(<span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">    next(data); <span class="comment">// 递归调用</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> ite = gen();</span><br><span class="line">next();</span><br></pre></td></tr></table></figure>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="http://es6.ruanyifeng.com/#docs/generator" target="_blank" rel="noopener">阮一峰 ECMAScript 6 入门</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/06/AMD-CMD-与-ES6Module/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="J.Y.">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="写字的地方">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/06/AMD-CMD-与-ES6Module/" itemprop="url">AMD, CMD, CommonJS 与 ES6Module</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-01-06T19:28:24+08:00">
                2020-01-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="AMD-Require-js"><a href="#AMD-Require-js" class="headerlink" title="AMD - Require.js"></a>AMD - Require.js</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>AMD - Require.js<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 引用 cdn require.js ，模块主入口为 index.js --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span></span></span><br><span class="line"><span class="tag">      <span class="attr">src</span>=<span class="string">"https://cdn.bootcss.com/require.js/2.3.6/require.js"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">data-main</span>=<span class="string">"./index.js"</span></span></span><br><span class="line"><span class="tag">    &gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="comment">// 请求模块 ./add</span></span><br><span class="line"><span class="built_in">require</span>([<span class="string">"./add"</span>], <span class="function"><span class="keyword">function</span>(<span class="params">addModule</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"执行 index.js"</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(addModule.add(<span class="number">1</span>, <span class="number">2</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add.js</span></span><br><span class="line">define([<span class="string">"require"</span>], <span class="function"><span class="keyword">function</span>(<span class="params">require, factory</span>) </span>&#123;</span><br><span class="line"><span class="meta">  "use strict"</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"执行 add.js"</span>);</span><br><span class="line">  <span class="keyword">var</span> add = <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 一个放在return对象中的函数，暴露出去被使用</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"执行 add.js 中 函数 add"</span>);</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    add: add</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>上面代码运行之后，可以看到控制台的输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">执行 add.js</span><br><span class="line">执行 index.js</span><br><span class="line">执行 add.js 中 函数 add</span><br><span class="line">3</span><br></pre></td></tr></table></figure>
<p>在打印 <code>&quot;执行 index.js&quot;</code> 前已经打印出 <code>&quot;执行 add.js&quot;</code>，<strong>这说明在 require 时，就对模块进行了加载和执行</strong>，之后将模块中 return 出来的内容放在变量 <code>addModule</code> 中。</p>
<h2 id="CMD-Sea-js"><a href="#CMD-Sea-js" class="headerlink" title="CMD - Sea.js"></a>CMD - Sea.js</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>CMD - Sea.js<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 引用 cdn sea.js ，模块主入口为 index.js --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.bootcss.com/seajs/3.0.3/sea.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./index.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"></span><br><span class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params">require, exports, module</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"执行 index.js"</span>);</span><br><span class="line">  <span class="keyword">var</span> addModule = <span class="built_in">require</span>(<span class="string">"./add"</span>); <span class="comment">// 请求模块 ./add</span></span><br><span class="line">  <span class="built_in">console</span>.log(addModule.add(<span class="number">1</span>, <span class="number">2</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add.js</span></span><br><span class="line">define([<span class="string">"require"</span>], <span class="function"><span class="keyword">function</span>(<span class="params">require, factory</span>) </span>&#123;</span><br><span class="line"><span class="meta">  "use strict"</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"执行 add.js"</span>);</span><br><span class="line">  <span class="keyword">var</span> add = <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    add: add</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>上面代码运行之后，可以看到控制台的输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">执行 index.js</span><br><span class="line">执行 add.js</span><br><span class="line">3</span><br></pre></td></tr></table></figure>
<p>打断点在 <code>var addModule = require(&quot;./add&quot;);</code> 语句之前，可以看到参数 module 中已经保存了 add.js 中的相关内容，<strong>可见与 require.js 相同，sea.js 也会对模块进行提前加载</strong>。<br>在打印 <code>&quot;执行 add.js&quot;</code> 前已经打印出 <code>&quot;执行 index.js&quot;</code>，<strong>这说明与 require.js 不同的时，sea.js 只有在 require 了模块时，才对模块进行了执行</strong>。之后将模块中 return 出来的内容放在变量 <code>addModule</code> 中。</p>
<h2 id="AMD-与-CMD-的区别"><a href="#AMD-与-CMD-的区别" class="headerlink" title="AMD 与 CMD 的区别"></a>AMD 与 CMD 的区别</h2><ol>
<li>AMD 依赖前置，需要引用的模块的模块都会写在最前面；CMD 不需要一开始什么自己需要的全部依赖是哪些，直接在代码中 require，但两者其实都会提前加载模块内容。</li>
<li>虽然两者都会提前加载模块内容，但执行时间是不同的。AMD 会在模块加载完毕后执行，而 CMD 会在代码执行到相应语句时，才执行模块中内容。</li>
</ol>
<h2 id="ES6-Module"><a href="#ES6-Module" class="headerlink" title="ES6 - Module"></a>ES6 - Module</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>ES6 - Module<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- type="module"表示加载的是 ES6 模块 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"module"</span> <span class="attr">src</span>=<span class="string">"./index.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"执行 index.js"</span>);</span><br><span class="line"><span class="keyword">import</span> addModule <span class="keyword">from</span> <span class="string">"./add.js"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(addModule.add(<span class="number">1</span>, <span class="number">2</span>));</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add.js</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"执行 add.js"</span>);</span><br><span class="line"><span class="keyword">var</span> add = <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123; add &#125;;</span><br></pre></td></tr></table></figure>
<p>上面代码运行之后，可以看到控制台的输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">执行 add.js</span><br><span class="line">执行 index.js</span><br><span class="line">3</span><br></pre></td></tr></table></figure>
<p>在 index.js 文件中，即使 import…from… 语句没有放在文件开头，依然先加载执行了 add.js 文件，打印出了 <code>&quot;执行 add.js&quot;</code>，并将 add.js 文件中 export 出来的内容放在了 addModule 中，<strong>可见 <code>import...from...</code> 会被提升到最前面</strong>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"执行 index.js"</span>);</span><br><span class="line"><span class="keyword">import</span> &#123; obj <span class="keyword">as</span> timeModule &#125; <span class="keyword">from</span> <span class="string">"./time.js"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(timeModule.getTime());</span><br><span class="line">timeModule.time = <span class="number">100</span>;</span><br><span class="line"><span class="comment">// timeModule.setTime(200);</span></span><br><span class="line"><span class="built_in">console</span>.log(timeModule.getTime());</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// time.js</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"执行 add.js"</span>);</span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  time: <span class="number">0</span>,</span><br><span class="line">  getTime: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.time;</span><br><span class="line">  &#125;,</span><br><span class="line">  setTime: <span class="function"><span class="keyword">function</span>(<span class="params">t</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.time = t;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; obj &#125;;</span><br></pre></td></tr></table></figure>
<p>上面代码运行之后，可以看到控制台的输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">执行 add.js</span><br><span class="line">执行 index.js</span><br><span class="line">0</span><br><span class="line">100</span><br></pre></td></tr></table></figure>
<p>可以看到我们直接在 index.js 中对 timeModule.time 重新赋值，对应的模块中的 time 也会相应变化，可见 import 得到的并不是一份内容的拷贝，只是一个引用。这一点不止对对象适用，对基本数据类型也是一样的。</p>
<h2 id="Node-CommonJS"><a href="#Node-CommonJS" class="headerlink" title="Node - CommonJS"></a>Node - CommonJS</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"执行 index.js"</span>);</span><br><span class="line"><span class="keyword">var</span> addModule = <span class="built_in">require</span>(<span class="string">"./add"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(addModule.add(<span class="number">1</span>, <span class="number">2</span>));</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add.js</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"执行 add.js"</span>);</span><br><span class="line"><span class="keyword">var</span> add = <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">module</span>.exports.add = add;</span><br></pre></td></tr></table></figure>
<p>打印结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">执行 index.js</span><br><span class="line">执行 add.js</span><br><span class="line">3</span><br></pre></td></tr></table></figure>
<p>与其他模块使用不同的是，CommonJS 不会提前执行，也不会提前加载，并且是同步加载（这与 Nodejs 应用于服务端有关系）。</p>
<h2 id="CommonJS-与-ES6Module"><a href="#CommonJS-与-ES6Module" class="headerlink" title="CommonJS 与 ES6Module"></a>CommonJS 与 ES6Module</h2><ol>
<li>CommonJS 模块是代码执行时同步加载执行，ES6Module 是编译时输出接口，也会提前执行。</li>
<li>CommonJS 引入的模块内容是一份值的拷贝，而 ES6Module 是值的引用，无论是基本数据类型，还是对象。</li>
</ol>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://juejin.im/post/5bea425751882508851b45d6#heading-0" target="_blank" rel="noopener">ES6 系列之模块加载方案</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/05/es6-module/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="J.Y.">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="写字的地方">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/05/es6-module/" itemprop="url">es6 module</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-01-05T16:47:17+08:00">
                2020-01-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="module-性质"><a href="#module-性质" class="headerlink" title="module 性质"></a>module 性质</h2><p>es6 中 module 是编译时加载，故在静态分析阶段不能做到的事情它也不能做，比如不能条件加载。（与 CommonJS 不同，CommonJS 是运行时加载）当运行代码时，模块都加载完毕，故 import 和 export 语句无论是在代码的何处，都相当于提升到文件顶部执行。</p>
<h2 id="导入导出默认值"><a href="#导入导出默认值" class="headerlink" title="导入导出默认值"></a>导入导出默认值</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// module.js</span></span><br><span class="line"><span class="keyword">let</span> time = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span><br><span class="line"><span class="keyword">const</span> TimeMgr = &#123;</span><br><span class="line">  date: <span class="string">""</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> &#123; time <span class="keyword">as</span> <span class="keyword">default</span>, TimeMgr &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 相当于：</span></span><br><span class="line"><span class="comment">// let time;</span></span><br><span class="line"><span class="comment">// export default time = new Date().getTime();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// export const TimeMgr = &#123;</span></span><br><span class="line"><span class="comment">//   date: ""</span></span><br><span class="line"><span class="comment">// &#125;;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span> time, &#123; TimeMgr &#125; <span class="keyword">from</span> <span class="string">"./module"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(time); <span class="comment">// 1577669922564</span></span><br><span class="line"><span class="built_in">console</span>.log(TimeMgr.data); <span class="comment">// ''</span></span><br></pre></td></tr></table></figure>
<ol>
<li>export 导出值需要放在大括号中，如果要视为 default 导出，可使用 as 重命名为 default。export 导出值也可直接在变量前加关键字 export 导出单个，如果要视为 default 导出，则在 export 和变量间加关键字 default，相当于将变量赋给 default。</li>
<li>一个文件导出变量中只能有一个默认值 default。</li>
<li>import 引用的变量需要放在大括号中，若不放在大括号中，则是引用对应导出文件的 default 变量</li>
</ol>
<h2 id="import-和-export-的复合写法"><a href="#import-和-export-的复合写法" class="headerlink" title="import 和 export 的复合写法"></a>import 和 export 的复合写法</h2><p>相当于先进行了 import 然后紧接着 export。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> &#123;rectData&#125; form <span class="string">'rectEle'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> area = rectData.width * rectData.height;</span><br></pre></td></tr></table></figure>
<p>此模块继承中体现了复合写法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// rectEle.js</span></span><br><span class="line"><span class="keyword">const</span> rectData = &#123;</span><br><span class="line">  width: <span class="number">10</span>,</span><br><span class="line">  height: <span class="number">20</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> &#123; rectData &#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// rect.js</span></span><br><span class="line"><span class="keyword">export</span> &#123; rectData &#125; <span class="keyword">from</span> <span class="string">"./rectEle"</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">getArea</span>(<span class="params">w, h</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> w * h;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 可视作：</span></span><br><span class="line"><span class="comment">// default = function getArea(w, h) &#123; return w * h;&#125;</span></span><br><span class="line"><span class="comment">// export &#123;default&#125;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span> getArea, &#123; rectData &#125; <span class="keyword">from</span> <span class="string">"./rect"</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(rectData); <span class="comment">// &#123; width:10, height: 20 &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`Rect: <span class="subst">$&#123;getArea(rectData.width, rectData.height)&#125;</span>`</span>); <span class="comment">// 'Rect: 200'</span></span><br></pre></td></tr></table></figure>
<p>上面例子中，rect.js 导入导出了 rectEle 中的变量 rectData，之后 index.js 中只需导入 rect，也可以读取 rectData。</p>
<h2 id="动态引入"><a href="#动态引入" class="headerlink" title="动态引入"></a>动态引入</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// module.js</span></span><br><span class="line"><span class="keyword">let</span> time = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  time = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> TimeMgr = &#123;</span><br><span class="line">  date: <span class="string">""</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; time <span class="keyword">as</span> <span class="keyword">default</span>, TimeMgr &#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span> time, &#123; TimeMgr &#125; <span class="keyword">from</span> <span class="string">"./module"</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(time);</span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(time);</span><br><span class="line">&#125;, <span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line">TimeMgr = <span class="string">"a"</span>; <span class="comment">// 报错："TimeMgr" is read-only</span></span><br><span class="line">TimeMgr.date = <span class="keyword">new</span> <span class="built_in">Date</span>(); <span class="comment">//对引用的值的某个属性重新进行赋值不会报错</span></span><br><span class="line"><span class="built_in">console</span>.log(TimeMgr.date);</span><br></pre></td></tr></table></figure>
<ol>
<li>利用 setTimeout 使被引用的模块内容 time 发生改变，可以看到引用的值也会相应改变。</li>
<li>对 TimeMgr 这个引用的值直接重新进行赋值会报错，因为其有属性 read-only。但对 TimeMgr 的其中一个属性 data 重新赋值不会报错。（不过不建议这么直接赋值，会让错误变得难以定位。可以在被引用文件中写类似函数 updateDate，通过调用函数更新属性值）。<br>（与 CommonJS 不同，CommonJS 是值的拷贝）</li>
</ol>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="http://es6.ruanyifeng.com/#docs/module" target="_blank" rel="noopener">阮一峰 ECMAScript 6 入门</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/04/es6-let/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="J.Y.">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="写字的地方">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/04/es6-let/" itemprop="url">es6 let</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-01-04T11:21:41+08:00">
                2020-01-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="let-特征"><a href="#let-特征" class="headerlink" title="let 特征"></a>let 特征</h2><p>我们知道了 let 声明一个块级作用域的本地变量。拥有下面特征：</p>
<ol>
<li>作用域只作用于块级；</li>
<li>不会变量提升（故而存在“暂存死区”）；</li>
<li>不允许重复声明；</li>
</ol>
<h2 id="let-与-for-循环"><a href="#let-与-for-循环" class="headerlink" title="let 与 for 循环"></a>let 与 for 循环</h2><p>可以通过两个例子了解 let 在 for 循环中的行为表现：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i += <span class="number">1</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> i = <span class="string">"a"</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果所得是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a</span><br><span class="line">a</span><br><span class="line">a</span><br></pre></td></tr></table></figure>
<p>这是因为 for 循环中的括号内 <code>for (let i = 0; i &lt; 3; i += 1)</code> 和大括号内的内容已经处于两个不同作用域，上面的例子用 babel 转换后代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i += <span class="number">1</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> _i = <span class="string">"a"</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(_i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到 <code>for (let i = 0; i &lt; 3; i += 1)</code> 和大括号内的 i 事实上不是同一个变量。其实也可以看成是大括号内是一个闭包，并且参数 i 保留其上下文变量：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _loop = <span class="function"><span class="keyword">function</span>(<span class="params">i</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> i = <span class="string">"a"</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(i);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i += <span class="number">1</span>) &#123;</span><br><span class="line">  _loop(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看另一个例子，这个体现得更为明显：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fn = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i += <span class="number">1</span>) &#123;</span><br><span class="line">  fn[i] = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line">fn[<span class="number">1</span>](); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<p>我们知道，如果使用 var 来定义括号内的 i，那么最终输出结果为 3，但是使用 let 来定义括号内的 i，输出结果为 1。我们使用 babel 转换上面代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fn = [];</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> _loop = <span class="function"><span class="keyword">function</span> <span class="title">_loop</span>(<span class="params">i</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> i = <span class="string">"abc"</span>;</span><br><span class="line"></span><br><span class="line">  fn[i] = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i += <span class="number">1</span>) &#123;</span><br><span class="line">  _loop(i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn[<span class="number">1</span>]();</span><br></pre></td></tr></table></figure>
<p>此时我们可以清楚看到循环的大括号内的内容被放在了另一个函数作用域内。这处理方式与我们上面例子是一样的。</p>
<h2 id="暂存死区"><a href="#暂存死区" class="headerlink" title="暂存死区"></a>暂存死区</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> i = <span class="string">"a"</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(i); <span class="comment">// a</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> i = <span class="string">"a"</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(i); <span class="comment">// ReferenceError</span></span><br><span class="line">  <span class="keyword">let</span> i = <span class="string">"b"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面第一个例子中打印 i 是正常的，但第二个例子会报错，原因是：<br>第一个例子中 i 对于它整个所处的作用域起作用，它进行了声明并赋值，所以后面读取 i 可以正常读取；第二个例子中在 if 块中有自己的对 i 的声明，此时这个块中读取的 i 不再是 if 外的 i，但是在 <code>console.log</code> 的地方，i 还未被初始化（let 没有变量提升，不会像 var 一样对变量初始化为 undefined），故 <code>console.log</code> 正处于 i 的暂存死区，此时读取 i 值被报错，报的错误也是 <code>Cannot access &#39;i&#39; before initialization</code>。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/02/es6-iterator/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="J.Y.">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="写字的地方">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/02/es6-iterator/" itemprop="url">es6 Iterator</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-01-02T21:50:23+08:00">
                2020-01-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Iterator-迭代器"><a href="#Iterator-迭代器" class="headerlink" title="Iterator 迭代器"></a>Iterator 迭代器</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>Iterator 是一个具有 next 方法的对象。通过调用 next 可以一步一步得到序列的值。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 迭代器对象可以通过重复调用next()显示迭代。</span></span><br><span class="line"><span class="keyword">let</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>([</span><br><span class="line">  [<span class="string">"a"</span>, <span class="number">1</span>],</span><br><span class="line">  [<span class="string">"b"</span>, <span class="number">2</span>]</span><br><span class="line">]);</span><br><span class="line"><span class="keyword">let</span> iter = map[<span class="string">"Symbol.iterator"</span>](); <span class="comment">// Iterator迭代器</span></span><br><span class="line">iter.next(); <span class="comment">// &#123;value: ["a", 1], done: false&#125;.</span></span><br><span class="line">iter.next(); <span class="comment">// &#123;value: ["b", 2], done: false&#125;.</span></span><br><span class="line">iter.next(); <span class="comment">// &#123;value: undefined, done: true&#125;.</span></span><br></pre></td></tr></table></figure>
<p>next() 方法的调用返回一个对象，对象中有两个属性 value 和 done。value 是序列中 next 的值，done 表示是否走到序列结束。</p>
<p>一些数据格式自带 Iterator 迭代器，比如 Array，Map，Set, NodeList 等。</p>
<p><img src="./images/iterator1.jpg" alt="&#39;prototype中的Symbol.iterator&#39;"></p>
<p>注意：object 没有遍历器，因为本身键值没有顺序。若要对 object 遍历，实际上可以直接使用 Map。</p>
<h3 id="Iterator-简单实现"><a href="#Iterator-简单实现" class="headerlink" title="Iterator 简单实现"></a>Iterator 简单实现</h3><p>简单实现一个可以体现 Iterator 的函数，使之可以这样调用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>, <span class="string">"d"</span>];</span><br><span class="line"><span class="keyword">const</span> iter = makeIterator(arr);</span><br><span class="line">iter.next(); <span class="comment">// &#123;value: 'a', done: false&#125;</span></span><br><span class="line">iter.next(); <span class="comment">// &#123;value: 'b', done: false&#125;</span></span><br><span class="line">iter.next(); <span class="comment">// &#123;value: 'c', done: false&#125;</span></span><br><span class="line">iter.next(); <span class="comment">// &#123;value: 'd', done: false&#125;</span></span><br><span class="line">iter.next(); <span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br></pre></td></tr></table></figure>
<p>那么 makeIterator 方法要返回一个对象，该对象中要有 next 方法，而 next 方法执行要返回一个对象，对象中有属性 value 和 done。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeIterator</span>(<span class="params">array</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> step = <span class="number">-1</span>;</span><br><span class="line">  <span class="keyword">const</span> len = array.length;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    next: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      step++;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        value: array[step],</span><br><span class="line">        done: step &gt;= len</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> arr = [<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>, <span class="string">"d"</span>];</span><br><span class="line"><span class="keyword">const</span> iter = makeIterator(arr);</span><br><span class="line">iter.next(); <span class="comment">// &#123;value: 'a', done: false&#125;</span></span><br><span class="line">iter.next(); <span class="comment">// &#123;value: 'b', done: false&#125;</span></span><br><span class="line">iter.next(); <span class="comment">// &#123;value: 'c', done: false&#125;</span></span><br><span class="line">iter.next(); <span class="comment">// &#123;value: 'd', done: false&#125;</span></span><br><span class="line">iter.next(); <span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br></pre></td></tr></table></figure>
<p>也可以利用生成器实现上面函数效果：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">makeIterator</span>(<span class="params">array</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> step = <span class="number">-1</span>;</span><br><span class="line">  <span class="keyword">const</span> len = array.length;</span><br><span class="line">  <span class="keyword">while</span> (step &lt; len) &#123;</span><br><span class="line">    step++;</span><br><span class="line">    <span class="keyword">yield</span> array[step];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> arr = [<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>, <span class="string">"d"</span>];</span><br><span class="line"><span class="keyword">const</span> iter = makeIterator(arr);</span><br><span class="line">iter.next(); <span class="comment">// &#123;value: 'a', done: false&#125;</span></span><br><span class="line">iter.next(); <span class="comment">// &#123;value: 'b', done: false&#125;</span></span><br><span class="line">iter.next(); <span class="comment">// &#123;value: 'c', done: false&#125;</span></span><br><span class="line">iter.next(); <span class="comment">// &#123;value: 'd', done: false&#125;</span></span><br><span class="line">iter.next(); <span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br></pre></td></tr></table></figure>
<p>上面例子通过函数简单实现数组的可迭代，实际上一个对象的迭代行为（比如 for…of）的过程中会调用该对象原型中 Symbol.iterator 接口。我们可以通过重写 Symbol.iterator 接口自定义可迭代对象：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myIterable = &#123;</span><br><span class="line">  *[<span class="built_in">Symbol</span>.iterator]() &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> v <span class="keyword">of</span> myIterable) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(v); <span class="comment">// 1 2 3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="for…of"><a href="#for…of" class="headerlink" title="for…of"></a>for…of</h2><p>不同内置可迭代对象 for…of 的表现：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>([</span><br><span class="line">  [<span class="string">"a"</span>, <span class="number">1</span>],</span><br><span class="line">  [<span class="string">"b"</span>, <span class="number">2</span>]</span><br><span class="line">]); <span class="comment">// Map(2) &#123;"a" =&gt; 1, "b" =&gt; 2&#125;</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> pair <span class="keyword">of</span> map) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(pair); <span class="comment">// (2)["a", 1], (2)["b", 2]</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">set</span> = new Set([1, 2, 3, 4]);</span><br><span class="line">for (let i of <span class="keyword">set</span>) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(i); <span class="comment">// 1, 2, 3, 4</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> pair <span class="keyword">of</span> <span class="keyword">set</span>.entries()) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(pair); <span class="comment">// (2)[1, 1] (2)[2, 2] (2)[3, 3] (2)[4, 4]</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> arr = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> arr) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(i); <span class="comment">// 1, 2, 3, 4</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> pair <span class="keyword">of</span> arr.entries()) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(pair); <span class="comment">// (2)[0, 1] (2)[1, 2] (2)[2, 3] (2)[3, 4]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面例子可以看到：</p>
<ol>
<li>map 的 for…of 直接得到键值对；</li>
<li>set 的 for…of 得到元素值，而对 set.entries() 得到的是键值相同的键值对；</li>
<li>array 的 for…of 得到元素值，而对 arr.entries() 得到的是索引与值的键值对。</li>
</ol>
<h3 id="for…in-与-for…of"><a href="#for…in-与-for…of" class="headerlink" title="for…in 与 for…of"></a>for…in 与 for…of</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> arr) &#123;</span><br><span class="line">  <span class="comment">// 如果循环的是数组</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">typeof</span> i); <span class="comment">// (4) string。数组索引为number，但这里返回string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> [i] <span class="keyword">of</span> arr.entries()) &#123;</span><br><span class="line">  <span class="comment">// 如果循环的是数组</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">typeof</span> i); <span class="comment">// (4) number。正常返回number</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从上面例子可以看到：</p>
<ol>
<li>for…in 得到的 i 总是 string，即使数组的索引应该为 number；</li>
<li>for…of 得到的 i 则与索引是同类型的；</li>
<li>那么 for…in 更适用 object，因为 object 的 key 值总是 string 类型。而 array 索引都为 number ； set, map 的键可以为各种类型.</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/20/defineProperty-Proxy/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="J.Y.">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="写字的地方">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/12/20/defineProperty-Proxy/" itemprop="url">defineProperty 与 Proxy</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-12-20T21:41:17+08:00">
                2019-12-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h2><h3 id="defineProperty"><a href="#defineProperty" class="headerlink" title="defineProperty"></a>defineProperty</h3><p>Object.defineProperty(obj, prop, descriptor);<br>obj: 对象。要定义属性的对象。<br>prop：字符串。要定义的属性名称。<br>descriptor：描述符。configurable(默认 false)，enumerable(默认 false)，[value（默认 undefined）, writable（默认 false）]/[get（getter 方法）, set（setter 方法）]。</p>
<p>注意点：</p>
<ol>
<li>[value, writable] 与 [get, set] 不能同时存在。</li>
<li>writable 为 true 时， value 才能被重新赋值。</li>
<li>configurable 表示对象能否被删除，以及除 writable 和 value 以外的属性能否被改变。</li>
</ol>
<p>value 与 writable：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj1 = &#123;&#125;;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(obj1, <span class="string">"name"</span>, &#123;</span><br><span class="line">  value: <span class="string">"tuffy"</span></span><br><span class="line">&#125;);</span><br><span class="line">obj1.name; <span class="comment">// 'tuffy'</span></span><br><span class="line">obj1.name = <span class="string">"joyee"</span>;</span><br><span class="line">obj1.name; <span class="comment">// 'tuffy',值没有被重新赋值，因为writable默认为false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj2 = &#123;&#125;;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(obj2, <span class="string">"name"</span>, &#123;</span><br><span class="line">  value: <span class="string">"tuffy"</span>,</span><br><span class="line">  writable: <span class="literal">true</span></span><br><span class="line">&#125;);</span><br><span class="line">obj2.name; <span class="comment">// 'tuffy'</span></span><br><span class="line">obj2.name = <span class="string">"joyee"</span>;</span><br><span class="line">obj2.name; <span class="comment">// 'joyee'，成功重新赋值</span></span><br></pre></td></tr></table></figure>
<p>get 与 set</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;&#125;;</span><br><span class="line"><span class="keyword">let</span> value = <span class="string">"tuffy"</span>;</span><br><span class="line"><span class="built_in">Object</span>.defineProperty(obj, <span class="string">"name"</span>, &#123;</span><br><span class="line">  <span class="keyword">get</span>: () =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">set</span>: v =&gt; &#123;</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"name"</span>).innerHTML = v; <span class="comment">// 绑定dom，当obj.name被重新赋值时，相应的dom内容也自动修改</span></span><br><span class="line">    value = v;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">obj.name; <span class="comment">// 'tuffy'</span></span><br><span class="line">obj.name = <span class="string">"joyee"</span>;</span><br><span class="line">obj.name; <span class="comment">// 'joyee'</span></span><br></pre></td></tr></table></figure>
<h3 id="Proxy"><a href="#Proxy" class="headerlink" title="Proxy"></a>Proxy</h3><p>let p = new Proxy(target, handler)<br>target: 对象/函数/代理对象。要进行代理的目标。<br>handler: 对象。定义代理行为。</p>
<p>注意点：</p>
<ol>
<li>Proxy 参数 handler 定义了代理的操作，但代理的对象是 p，不是 target。</li>
<li>Proxy 可以代理 13 中操作。包括 get, set, has, apply 等。</li>
</ol>
<p>举例 get 和 set 的使用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">name</span>: <span class="string">"tuffy"</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="built_in">Proxy</span>(obj, &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * target: 目标对象，这里指obj</span></span><br><span class="line"><span class="comment">   * prop：属性名</span></span><br><span class="line"><span class="comment">   * receiver：代理实例，这里指p</span></span><br><span class="line"><span class="comment">   **/</span></span><br><span class="line">  <span class="keyword">get</span>: (target, prop, receiver) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (!target[prop]) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"not this prop"</span>); <span class="comment">// 如果企图获取不存在的属性，报出错误</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`This is <span class="subst">$&#123;target[prop]&#125;</span>`</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * target: 目标对象，这里指obj</span></span><br><span class="line"><span class="comment">   * prop：属性名</span></span><br><span class="line"><span class="comment">   * value: 属性值</span></span><br><span class="line"><span class="comment">   * receiver：代理实例，这里指p</span></span><br><span class="line"><span class="comment">   **/</span></span><br><span class="line">  <span class="keyword">set</span>: (target, prop, value, receiver) =&gt; &#123;</span><br><span class="line">    target[prop] = value;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">p.name; <span class="comment">// 'This is Tuffy'</span></span><br><span class="line">p.age; <span class="comment">// Uncaught Error: not this prop</span></span><br><span class="line">p.age = <span class="number">18</span>;</span><br><span class="line">p.age; <span class="comment">// 18</span></span><br></pre></td></tr></table></figure>
<h2 id="相似与不同"><a href="#相似与不同" class="headerlink" title="相似与不同"></a>相似与不同</h2><p>defineProperty 和 Proxy 都可以拦截对象的赋值与获取，可以定义 get 和 set 操作执行的函数，实现赋值前验证等功能。但：</p>
<ol>
<li>defineProperty 拦截的是对目标对象本身的操作，而 Proxy 则是对代理对象，对目标对象不起作用。</li>
<li>Proxy 代理的操作有 13 中，而 defineProperty 只有 get 和 set。</li>
<li>Proxy 更侧重于定义操作，而 defineProperty 可更改描述符。</li>
</ol>
<h2 id="延伸：Reflect"><a href="#延伸：Reflect" class="headerlink" title="延伸：Reflect"></a>延伸：Reflect</h2><p>内置对象 Reflect 有 13 个静态方法，如 Reflect.set(), Reflect.get(), Reflect.apply() 等。</p>
<p>注意点：</p>
<ol>
<li>上述所说的方法都是静态方法，即都是通过 Reflect.xxx 来调用。</li>
<li>Reflect 并不是一个构造函数，不能通过 new 运算符获得实例。</li>
<li>Reflect 的 13 个方法与 Proxy 的代理操作一一对应，两者可配合使用。通过 Proxy 代理操作，通过 Reflect 实际操作对象相关属性等。</li>
</ol>
<p>基本使用举例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;&#125;;</span><br><span class="line"><span class="built_in">Reflect</span>.set(obj, <span class="string">"name"</span>, <span class="string">"tuffy"</span>); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">Reflect</span>.get(obj, <span class="string">"name"</span>); <span class="comment">// 'tuffy'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 与 Proxy 结合使用</span></span><br><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">name</span>: <span class="string">"tuffy"</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="built_in">Proxy</span>(obj, &#123;</span><br><span class="line">  <span class="keyword">get</span>: (target, prop, receiver) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (!target[prop]) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"not this prop"</span>); <span class="comment">// 如果企图获取不存在的属性，报出错误</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`This is <span class="subst">$&#123;<span class="built_in">Reflect</span>.get(target, prop)&#125;</span>`</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">set</span>: (target, prop, value, receiver) =&gt; &#123;</span><br><span class="line">    <span class="built_in">Reflect</span>.set(target, prop, value);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="Reflect-与-Object"><a href="#Reflect-与-Object" class="headerlink" title="Reflect 与 Object"></a>Reflect 与 Object</h3><ol>
<li>一些返回结果的不同；</li>
<li>都为函数调用，而不是对 obj 的命令操作。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = <span class="number">1</span>;</span><br><span class="line">obj[<span class="string">"name"</span>] = <span class="string">"tuffy"</span>; <span class="comment">// 'tuffy',对number类型属性赋值，并没有报错</span></span><br><span class="line">obj; <span class="comment">// 1，其实赋值没有成功</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">Reflect</span>.set(obj, <span class="string">"name"</span>, <span class="string">"tuffy"</span>); <span class="comment">// Uncaught Error: Reflect.set called on non-object</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/18/es6-map-set/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="J.Y.">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="写字的地方">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/12/18/es6-map-set/" itemprop="url">es6 Map,WeakMap 与 Set,WeakSet</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-12-18T22:52:16+08:00">
                2019-12-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h2><p>Map 与 Object 一些区别：</p>
<ol>
<li>Map 是有序的；</li>
<li>Map 有 size 方法；</li>
<li>Map 键可以为任意类型，不止 string 和 symbol；</li>
<li>Map 有 entries 方法，可使用 for…of 得到键值数组；</li>
</ol>
<h2 id="WeakMap"><a href="#WeakMap" class="headerlink" title="WeakMap"></a>WeakMap</h2><p>Map 与 WeakMap 区别：</p>
<p>WeakMap 只有 get, set, delete, has 方法，没有遍历相关方法。因为 WeakMap 对其键是弱引用，其键是不可枚举的。</p>
<blockquote>
<p>强引用：当某变量被强引用时，即使该变量设为 null，该块内容也不会被垃圾回收，因为还存在着引用它的地方。</p>
</blockquote>
<blockquote>
<p>WeakMap 的键是弱引用，它不能阻止对应的 key 的内容被垃圾回收，当被回收时，对应的键值对也自动消失。</p>
</blockquote>
<h2 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h2><p>Set 是一组值的集合，且其中的元素都是唯一的。像对象那样拥有 keys/values（entries）方法，基本操作方法：add/delete/has/size，同时可以与 Array 相互转换。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数组转为Set</span></span><br><span class="line"><span class="keyword">const</span> arr1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">const</span> set1 = <span class="keyword">new</span> <span class="built_in">Set</span>(arr1);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Set转为数组</span></span><br><span class="line"><span class="keyword">const</span> arr2 = [...set1];</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"><span class="keyword">const</span> arr3 = <span class="built_in">Array</span>.from(set1);</span><br></pre></td></tr></table></figure>
<p>利用 Set 中元素的唯一性以及与数组的互换可以达到数组去重，取交集，取差集等目的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 去重</span></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">arr = [...new <span class="built_in">Set</span>(arr)]; <span class="comment">// [1, 2, 3]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 取交集</span></span><br><span class="line"><span class="keyword">let</span> arr1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="keyword">let</span> arr2 = [<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>];</span><br><span class="line"><span class="keyword">let</span> set2 = <span class="keyword">new</span> <span class="built_in">Set</span>(arr2);</span><br><span class="line">arr = arr1.filter(<span class="function"><span class="params">i</span> =&gt;</span> set2.has(i)); <span class="comment">// [2, 3, 5]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 取差集</span></span><br><span class="line">arr1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line">arr2 = [<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>];</span><br><span class="line">set2 = <span class="keyword">new</span> <span class="built_in">Set</span>(arr2);</span><br><span class="line">arr = arr1.filter(<span class="function"><span class="params">i</span> =&gt;</span> !set2.has(i)); <span class="comment">// [1, 4]</span></span><br></pre></td></tr></table></figure>
<h2 id="WeakSet"><a href="#WeakSet" class="headerlink" title="WeakSet"></a>WeakSet</h2><p>Set 与 WeakSet 的关系，与 Map 同 WeakMap 的关系类似，WeakSet 中的值只能存放对象的引用，不能是基本数据类型，同时对其元素只保持了弱引用（不可枚举）。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/07/File-base64-blob-与-canvas/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="J.Y.">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="写字的地方">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/11/07/File-base64-blob-与-canvas/" itemprop="url">File, base64, blob 与 canvas</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-11-07T22:26:20+08:00">
                2019-11-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="预览图片"><a href="#预览图片" class="headerlink" title="预览图片"></a>预览图片</h2><h3 id="使用-URL-对象"><a href="#使用-URL-对象" class="headerlink" title="使用 URL 对象"></a>使用 URL 对象</h3><p>URL.createObjectURL 方法可以生成一个指向某个 File 对象，Blob 对象或者 MediaSource 对象的 URL。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">"input"</span>).addEventListener(<span class="string">"change"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> target = e.target;</span><br><span class="line">  <span class="keyword">const</span> [file] = target.files;</span><br><span class="line">  <span class="built_in">console</span>.log(file);</span><br><span class="line">  <span class="keyword">if</span> (URL) &#123;</span><br><span class="line">    <span class="keyword">const</span> url = URL.createObjectURL(file); <span class="comment">// blob:xxx/xxxxxxx 生成一个url，可以直接通过这个url访问到图片。</span></span><br><span class="line">    <span class="built_in">console</span>.log(url);</span><br><span class="line">    $$(<span class="string">"preview"</span>).setAttribute(<span class="string">"src"</span>, url);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>URL.createObjectURL 的参数也可以是一个 blob 对象，所以通过此方法也可以将 blob 格式图片显示出来。<br>当不需要这个 URL 对象时，通过 URL.revokeObjectURL() 方法释放。</p>
<h3 id="使用-FileReader-对象"><a href="#使用-FileReader-对象" class="headerlink" title="使用 FileReader 对象"></a>使用 FileReader 对象</h3><p>FileReader.readAsDataURL 方法接收一个 File 对象或 Blob 对象为参数，触发 onload 事件，此时 FileReader.result 为对应的 base64 编码。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">"input"</span>).addEventListener(<span class="string">"change"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> target = e.target;</span><br><span class="line">  <span class="keyword">const</span> [file] = target.files;</span><br><span class="line">  <span class="built_in">console</span>.log(file);</span><br><span class="line">  <span class="comment">// file to base64 使用对象FileReader</span></span><br><span class="line">  <span class="keyword">const</span> fr = <span class="keyword">new</span> FileReader();</span><br><span class="line">  fr.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(fr.result); <span class="comment">// data:image/xxx;base64,/....</span></span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"preview"</span>).setAttribute(<span class="string">"src"</span>, fr.result); <span class="comment">// 可以直接将img的src赋值为base64，直接显示图片</span></span><br><span class="line">  &#125;;</span><br><span class="line">  fr.readAsDataURL(file);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>fr.readAsDataURL 的参数也可以是一个 blob 对象，所以通过此方法也可以将 blob 格式图片显示出来。<strong>也可将 blob 转为 base64</strong></p>
<h2 id="File-转为-base64-File-转为-Blob"><a href="#File-转为-base64-File-转为-Blob" class="headerlink" title="File 转为 base64, File 转为 Blob"></a>File 转为 base64, File 转为 Blob</h2><h3 id="使用-Canvas"><a href="#使用-Canvas" class="headerlink" title="使用 Canvas"></a>使用 Canvas</h3><p>将 File 通过 URL.createObjectURL 方法得到指向图片的 url，创建一个 Image 对象存放该 url 图片，再绘制在 canvas 上，通过 canvas.toDataURL 方法得到图片的 base64。（常利用 Canvas 对图片进行一定的裁剪）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">"input"</span>).addEventListener(<span class="string">"change"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> target = e.target;</span><br><span class="line">  <span class="keyword">const</span> [file] = target.files;</span><br><span class="line">  <span class="built_in">console</span>.log(file);</span><br><span class="line">  <span class="keyword">if</span> (URL) &#123;</span><br><span class="line">    <span class="keyword">const</span> url = URL.createObjectURL(file); <span class="comment">// blob:xxx/xxxxxxx 生成一个url，可以直接通过这个url访问到图片。</span></span><br><span class="line">    <span class="built_in">console</span>.log(url);</span><br><span class="line">    <span class="keyword">const</span> img = <span class="keyword">new</span> Image();</span><br><span class="line">    img.src = url;</span><br><span class="line">    img.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">const</span> canvas = <span class="built_in">document</span>.createElement(<span class="string">"canvas"</span>);</span><br><span class="line">      <span class="keyword">const</span> ctx = canvas.getContext(<span class="string">"2d"</span>);</span><br><span class="line">      ctx.drawImage(img, <span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height);</span><br><span class="line">      <span class="keyword">const</span> base64Url = canvas.toDataURL(<span class="string">"image/jpeg"</span>, <span class="number">0.5</span>); <span class="comment">// 转为base64（可指定图片格式与质量）</span></span><br><span class="line">      <span class="built_in">console</span>.log(base64Url); <span class="comment">// data:image/jpeg;base64,....</span></span><br><span class="line">      canvas.toBlob(</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params">blob</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// 转为Blob（可指定图片格式与质量）</span></span><br><span class="line">          <span class="built_in">console</span>.log(blob); <span class="comment">// Blob &#123; size: xxx, type: 'image/jpeg' &#125;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"image/jpeg"</span>,</span><br><span class="line">        <span class="number">0.5</span></span><br><span class="line">      );</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="使用-FileReader-对象-1"><a href="#使用-FileReader-对象-1" class="headerlink" title="使用 FileReader 对象"></a>使用 FileReader 对象</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">"input"</span>).addEventListener(<span class="string">"change"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> target = e.target;</span><br><span class="line">  <span class="keyword">const</span> [file] = target.files;</span><br><span class="line">  <span class="built_in">console</span>.log(file);</span><br><span class="line">  <span class="keyword">const</span> fr = <span class="keyword">new</span> FileReader();</span><br><span class="line">  fr.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(fr.result); <span class="comment">// data:image/xxx;base64,/....</span></span><br><span class="line">  &#125;;</span><br><span class="line">  fr.readAsDataURL(file);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>FileReader.readAsArrayBuffer 在 onload 中 result 对应 ArrayBuffer 数据；<br>FileReader.readAsBinaryString 在 onload 中 result 对应 blob 数据（非标准特性）。</p>
<h2 id="base64-转为-Blob"><a href="#base64-转为-Blob" class="headerlink" title="base64 转为 Blob"></a>base64 转为 Blob</h2><p>FileReader 有直接的标准方法将 Blob 转为 base64。此处写方法将 base64 转为 Blob。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dataURIToBlob</span>(<span class="params">uri</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 如uri：// data:image/jpeg;base64,/....</span></span><br><span class="line">  <span class="keyword">const</span> mimeString = uri</span><br><span class="line">    .split(<span class="string">","</span>)[<span class="number">0</span>]</span><br><span class="line">    .split(<span class="string">":"</span>)[<span class="number">1</span>]</span><br><span class="line">    .split(<span class="string">";"</span>)[<span class="number">0</span>]; <span class="comment">// 例子中得到的是："image/jpeg"</span></span><br><span class="line">  <span class="keyword">const</span> byteString = atob(uri.split(<span class="string">","</span>)[<span class="number">1</span>]); <span class="comment">// 例子中"/..."部分进行解码</span></span><br><span class="line">  <span class="keyword">const</span> arrayBuffer = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(byteString.length);</span><br><span class="line">  <span class="keyword">const</span> intArray = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(arrayBuffer);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; byteString.length; i += <span class="number">1</span>) &#123;</span><br><span class="line">    intArray[i] = byteString.charCodeAt(i);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> blob = <span class="keyword">new</span> Blob([intArray], &#123; <span class="attr">type</span>: mimeString &#125;);</span><br><span class="line">  <span class="keyword">return</span> blob;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/17/typescript学习/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="J.Y.">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="写字的地方">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/17/typescript学习/" itemprop="url">typescript 学习（一）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-17T22:47:20+08:00">
                2019-10-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="一、基本数据类型及数组"><a href="#一、基本数据类型及数组" class="headerlink" title="一、基本数据类型及数组"></a>一、基本数据类型及数组</h2><p>基本数据类型有：number，string，boolean，null，undefined，symbol。<br>数组：两种表示方式如 number[]和 Array &lt;number>，number 可以换成其他类型，表示数组中的元素类型。<br>不同类型的变量不能互相赋值。特别的，null 和 undefined 是所有类型的子类型，可以被赋值到其他类型的变量。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 基本数据类型</span></span><br><span class="line"><span class="keyword">let</span> username: string = <span class="string">"tuffy"</span>;</span><br><span class="line"><span class="keyword">let</span> age: number = <span class="number">12</span>;</span><br><span class="line"><span class="keyword">const</span> u: <span class="literal">undefined</span> = <span class="literal">undefined</span>;</span><br><span class="line"><span class="keyword">const</span> n: <span class="literal">null</span> = <span class="literal">null</span>;</span><br><span class="line">username = u; <span class="comment">// 编译通过：将undefined类型赋值到string类型变量</span></span><br><span class="line">username = n; <span class="comment">// 编译通过：将null类型赋值到string类型变量</span></span><br><span class="line">username = age; <span class="comment">// 编译报错：将number类型赋值到string类型变量</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 数组</span></span><br><span class="line"><span class="keyword">let</span> arr: number[];</span><br><span class="line">arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">arr = <span class="literal">null</span>;</span><br><span class="line">arr = [<span class="number">1</span>, <span class="literal">null</span>];</span><br><span class="line"><span class="keyword">let</span> arr1: string[] = <span class="literal">undefined</span>;</span><br></pre></td></tr></table></figure>
<h2 id="二、任意类型"><a href="#二、任意类型" class="headerlink" title="二、任意类型"></a>二、任意类型</h2><p>any 表示允许赋值为任意类型。<br>当声明一个变量并没有指明数据类型时，将会推论为 any。但如果在声明的同时被进行赋值，那么该变量会被推断为该数值的类型。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> notType = <span class="string">"123"</span>; <span class="comment">// 推断为 string 类型</span></span><br><span class="line">notType = <span class="number">1</span>; <span class="comment">// 编译报错:再赋值为 number 类型数值时报错</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> anyType; <span class="comment">// 推断为 any 类型</span></span><br><span class="line">anyType = <span class="string">"123"</span>; <span class="comment">// 编译通过</span></span><br><span class="line">anyType = <span class="number">123</span>; <span class="comment">// 编译通过</span></span><br></pre></td></tr></table></figure>
<h2 id="三、联合类型"><a href="#三、联合类型" class="headerlink" title="三、联合类型"></a>三、联合类型</h2><p>假如知道变量要么是 string 类型要么是 number 类型，不会是别的类型，但不能确定是 string 还是 number 时，可以使用联合类型。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> unionTypes: string | number;</span><br><span class="line"><span class="keyword">let</span> a: number = unionTypes.length; <span class="comment">// 编译报错</span></span><br><span class="line"><span class="keyword">let</span> b: string = unionTypes.toString(); <span class="comment">// 编译通过</span></span><br><span class="line"></span><br><span class="line">unionTypes = <span class="string">"123"</span>;</span><br><span class="line">a = unionTypes.length; <span class="comment">// 编译通过</span></span><br><span class="line">unionTypes = <span class="number">123</span>;</span><br><span class="line">a = unionTypes.length; <span class="comment">// 编译报错</span></span><br></pre></td></tr></table></figure>
<h2 id="四、函数"><a href="#四、函数" class="headerlink" title="四、函数"></a>四、函数</h2><p>函数的两种定义方式：函数声明和函数表达式。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add1</span>(<span class="params">a: number, b?: number, c?: number</span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> add2: <span class="function">(<span class="params">a: number, b?: number, c?: number</span>) =&gt;</span> number = <span class="function"><span class="keyword">function</span> (<span class="params">a: number, b?: number, c?: number</span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 此处与 add2 不同，其实并没有直接对 add3 进行类型定义，是通过类型推断所得</span></span><br><span class="line"><span class="keyword">let</span> add3 = <span class="function"><span class="keyword">function</span> (<span class="params">a: number, b?: number, c?: number</span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>函数可以定义<strong>可选参数</strong>，但可选参数必须放在必填参数后面，即后面不能再有必填参数。<br>函数可以定义<strong>剩余参数</strong>，但剩余参数必须放在参数最后，即必须是最后一个参数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a: number, b?: number, ...items: number[]</span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="五、类"><a href="#五、类" class="headerlink" title="五、类"></a>五、类</h2><p>抽象类（类前面加 abstract ），不能被实例化，一般而言它存在的意义是被子类继承实现。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">abstract <span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  public name: string;</span><br><span class="line">  public <span class="keyword">constructor</span>(name: string) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">  &#125;</span><br><span class="line">  public abstract say(); <span class="comment">// 抽象类中有抽象方法 say</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(name: string) &#123;</span><br><span class="line">    <span class="keyword">super</span>(name);</span><br><span class="line">  &#125;</span><br><span class="line">  public say() &#123; <span class="comment">// 继承自 Animal 的类，必须实现其抽象方法，此处若无该函数会报错</span></span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> animal: Animal = <span class="keyword">new</span> Animal(<span class="string">'wang'</span>); <span class="comment">// 编译报错：无法创建抽象类实例</span></span><br><span class="line"><span class="keyword">let</span> dog: Dog = <span class="keyword">new</span> Dog(<span class="string">'wang'</span>); <span class="comment">// 编译通过</span></span><br></pre></td></tr></table></figure>
<h2 id="六、接口"><a href="#六、接口" class="headerlink" title="六、接口"></a>六、接口</h2><p>接口可以描述对象的外形，类的一部分外形。</p>
<h3 id="1-接口描述对象"><a href="#1-接口描述对象" class="headerlink" title="1. 接口描述对象"></a>1. 接口描述对象</h3><p>当声明一个对象为某接口类型后，该对象属性需与接口属性保持一致。属性类型不能不同，不能多属性，不能少属性（除非接口中指明是可选属性，但这其实也是保持一致的一种方式）。此外，接口中可以由任意属性，即可以不写明属性名。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">interface IPerson &#123;</span><br><span class="line">  name: string;</span><br><span class="line">  age: number;</span><br><span class="line">  [prop: string]: any;</span><br><span class="line">  [index: number]: string;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> person: IPerson;</span><br><span class="line">person = &#123;</span><br><span class="line">  name: <span class="string">"tuffy"</span>,</span><br><span class="line">  age: <span class="number">12</span>,</span><br><span class="line">  hobby: <span class="string">"123"</span></span><br><span class="line">&#125;;</span><br><span class="line">person[<span class="number">0</span>] = <span class="string">"123"</span>;</span><br></pre></td></tr></table></figure>
<p>特别的，当定义了某个类型字段名的任意属性后，同类型字段的属性的类型必须是其同类型或其子类型，如下面编译将会报错：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">interface IPerson &#123;</span><br><span class="line">  name: string;</span><br><span class="line">  age: number; <span class="comment">// 编译报错</span></span><br><span class="line">  [prop: string]: string;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> person: IPerson;</span><br><span class="line">person = &#123;</span><br><span class="line">  name: <span class="string">"tuffy"</span>,</span><br><span class="line">  age: <span class="number">12</span>,</span><br><span class="line">  hobby: <span class="string">"123"</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>接口的只读属性，只读是指该接口的这个属性不能被重新赋值，只能通过赋值给这个对象得以更新这个属性。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">interface IPerson &#123;</span><br><span class="line">  readonly name: string,</span><br><span class="line">  age: number</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> person: IPerson;</span><br><span class="line">person.name = <span class="string">'tuffy'</span>; <span class="comment">// 编译报错。即使person还未被赋值过，也不能直接赋值这个属性</span></span><br><span class="line"></span><br><span class="line">interface IPerson &#123;</span><br><span class="line">  readonly name: string,</span><br><span class="line">  age: number</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> person: IPerson;</span><br><span class="line">person = &#123;</span><br><span class="line">  name: <span class="string">'tuffy'</span>,</span><br><span class="line">  age: <span class="number">12</span></span><br><span class="line">&#125;;</span><br><span class="line">person = &#123;</span><br><span class="line">  name: <span class="string">'tuffy1'</span>, <span class="comment">// 编译通过。这样赋值整个对象是可以的</span></span><br><span class="line">  age: <span class="number">12</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="2-接口描述类数组"><a href="#2-接口描述类数组" class="headerlink" title="2. 接口描述类数组"></a>2. 接口描述类数组</h3><p>类数组与数组是不同的，可以结合任意属性描述类数组。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">interface IArgument &#123;</span><br><span class="line">  [index: number]: any;</span><br><span class="line">  length: number;</span><br><span class="line">  callee: <span class="built_in">Function</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-接口描述函数"><a href="#3-接口描述函数" class="headerlink" title="3. 接口描述函数"></a>3. 接口描述函数</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">interface IAdd &#123;</span><br><span class="line">  (a: number, b?: number, c?: number): number</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> add: IAdd = <span class="function"><span class="keyword">function</span> (<span class="params">a: number, b?: number, c?: number</span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">interface Person &#123;</span><br><span class="line">  (name: string): string;</span><br><span class="line">  age: number;</span><br><span class="line">  setName(): <span class="keyword">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">personFun</span>(<span class="params"></span>): <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> person = <span class="xml"><span class="tag">&lt;<span class="name">Person</span>&gt;</span>function(name: string): string &#123; return 'tuffy' &#125;;</span></span><br><span class="line"><span class="xml">  person.age = 12;</span></span><br><span class="line"><span class="xml">  person.setName = function(): void &#123;&#125;;</span></span><br><span class="line"><span class="xml">  return person;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="4-接口被类实现-与-接口继承类"><a href="#4-接口被类实现-与-接口继承类" class="headerlink" title="4. 接口被类实现 与 接口继承类"></a>4. 接口被类实现 与 接口继承类</h3><p>（1）接口被类实现：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">interface IInfo &#123;</span><br><span class="line">  name: string;</span><br><span class="line">&#125;</span><br><span class="line">interface IClasses &#123;</span><br><span class="line">  className: string;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="title">implements</span> <span class="title">IInfo</span>, <span class="title">IClasses</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 一个类可以实现多个接口</span></span><br><span class="line">  name: string;</span><br><span class="line">  className: string;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>（2）接口继承类</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InfoManage</span> </span>&#123;</span><br><span class="line">  role: number;</span><br><span class="line">  public setRole(role: number) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">interface IInfo extends InfoManage &#123;</span><br><span class="line">  name: string</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> info: IInfo = &#123;</span><br><span class="line">  name: <span class="string">'tuffy'</span>,</span><br><span class="line">  role: <span class="number">1</span>,</span><br><span class="line">  setRole: <span class="function"><span class="keyword">function</span> (<span class="params">role: number</span>) </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="七、type"><a href="#七、type" class="headerlink" title="七、type"></a>七、type</h2><h3 id="1-type-与-interface-的相同与继承"><a href="#1-type-与-interface-的相同与继承" class="headerlink" title="1. type 与 interface 的相同与继承"></a>1. type 与 interface 的相同与继承</h3><p>当描述对象时，type 与 interface 表现很相似，都可以进行继承，并且两者之间可以互相继承：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 语法略有不同，type 需要等号</span></span><br><span class="line">interface IUser1 &#123;</span><br><span class="line">  name: string;</span><br><span class="line">&#125;</span><br><span class="line">type IUser2 = &#123;</span><br><span class="line">  name: string</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// interface 与 type 的继承</span></span><br><span class="line">interface IUser1 &#123;</span><br><span class="line">  name: string;</span><br><span class="line">&#125;</span><br><span class="line">interface IUserExtend1 extends IUser1 &#123;</span><br><span class="line">  age: number;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> userExtend: IUserExtend1 = &#123;</span><br><span class="line">  name: <span class="string">"tuffy"</span>,</span><br><span class="line">  age: <span class="number">123</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">type IUser2 = &#123;</span><br><span class="line">  name: string</span><br><span class="line">&#125;;</span><br><span class="line">type IUserExtend2 = IUser2 &amp; &#123;</span><br><span class="line">  age: number</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> userExtend2: IUserExtend2 = &#123;</span><br><span class="line">  name: <span class="string">"tuffy"</span>,</span><br><span class="line">  age: <span class="number">123</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// interface 和 type 之间相互继承也是可以的</span></span><br><span class="line"><span class="comment">// interface IUserExtend1 extends IUser2 &#123;&#125;</span></span><br><span class="line"><span class="comment">// type IUserExtend2 = IUser1 &amp; &#123;&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-type-与-interface-的不同"><a href="#2-type-与-interface-的不同" class="headerlink" title="2. type 与 interface 的不同"></a>2. type 与 interface 的不同</h3><p>不同的是，type 也可以描述一个基本数据类型（即给基本数据类型别名），联合类型</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">type s = string; <span class="comment">// 相当于给了string类型一个别名s</span></span><br><span class="line">type IUser2 = &#123;</span><br><span class="line">  name: string</span><br><span class="line">&#125;;</span><br><span class="line">type IUser3 = s | IUser2;</span><br><span class="line"><span class="keyword">let</span> typeUser: IUser3;</span><br><span class="line">typeUser = <span class="string">"123"</span>; <span class="comment">// 编译通过</span></span><br><span class="line">typeUser = &#123; <span class="attr">name</span>: <span class="string">"123"</span> &#125;; <span class="comment">// 编译通过</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 利用 type 限制了 str 的几种可能取值</span></span><br><span class="line">type str = <span class="string">"str1"</span> | <span class="string">"str2"</span> | <span class="string">"str3"</span>;</span><br><span class="line"><span class="keyword">let</span> strNew: str;</span><br><span class="line">strNew = <span class="string">"str1"</span>;</span><br><span class="line">strNew = <span class="string">"str"</span>;</span><br></pre></td></tr></table></figure>
<p>而 interface 的合并，type 则没有：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 下面是可行的，IUser1 会合并</span></span><br><span class="line">interface IUser1 &#123;</span><br><span class="line">  name: string;</span><br><span class="line">&#125;</span><br><span class="line">interface IUser1 &#123;</span><br><span class="line">  age: number;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> user: IUser1 = &#123;</span><br><span class="line">  name: <span class="string">"tuffy"</span>,</span><br><span class="line">  age: <span class="number">2</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 下面是不可行的，会报错</span></span><br><span class="line">type IUser2 = &#123;</span><br><span class="line">  <span class="comment">// 编译报错</span></span><br><span class="line">  name: string</span><br><span class="line">&#125;;</span><br><span class="line">type IUser2 = &#123;</span><br><span class="line">  <span class="comment">// 编译报错</span></span><br><span class="line">  age: number</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="八、泛型"><a href="#八、泛型" class="headerlink" title="八、泛型"></a>八、泛型</h2><p>实现函数、接口或者类的时候，一些属性需要保证是同一类型，但具体是什么类型需要使用时确定，这时可以使用泛型。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">interface Lengthwise &#123;</span><br><span class="line">  length: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loggingIdentity</span>&lt;<span class="title">T</span> <span class="title">extends</span> <span class="title">Lengthwise</span>&gt;(<span class="params">arg: T</span>): <span class="title">T</span> </span>&#123; <span class="comment">// 使得泛型T一定要有属性length</span></span><br><span class="line">  <span class="built_in">console</span>.log(arg.length);</span><br><span class="line">  <span class="keyword">return</span> arg;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>泛型函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">interface GenericIdentityFn &#123;</span><br><span class="line">  &lt;T&gt;(arg: T): T;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">identity</span>&lt;<span class="title">T</span>&gt;(<span class="params">arg: T</span>): <span class="title">T</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> arg;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> myIdentity: GenericIdentityFn = identity;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 另一种写法</span></span><br><span class="line">interface GenericIdentityFn&lt;T&gt; &#123;</span><br><span class="line">  (arg: T): T;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">identity</span>&lt;<span class="title">T</span>&gt;(<span class="params">arg: T</span>): <span class="title">T</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> arg;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> myIdentity: GenericIdentityFn&lt;number&gt; = identity;</span><br></pre></td></tr></table></figure>
<h2 id="九、元组"><a href="#九、元组" class="headerlink" title="九、元组"></a>九、元组</h2><p>元组是数组，但是指定了 index 对应的元素的类型。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 当直接给某元组类型的变量赋值时，元素数不能多，也不能少，类型顺序也不能换</span></span><br><span class="line">type tupleArr1 = [string, number];</span><br><span class="line"><span class="keyword">let</span> tArr1: tupleArr1;</span><br><span class="line">tArr = [<span class="string">"tuffy"</span>, <span class="number">12</span>]; <span class="comment">// 编译通过</span></span><br><span class="line">tArr = [<span class="string">"tuffy"</span>]; <span class="comment">// 编译报错</span></span><br><span class="line">tArr = [<span class="string">"tuffy"</span>, <span class="number">12</span>, <span class="number">2019</span>]; <span class="comment">// 编译报错</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以通过给变量的某index赋值</span></span><br><span class="line">type tupleArr2 = [string, number];</span><br><span class="line"><span class="keyword">let</span> tArr2: tupleArr2;</span><br><span class="line">tArr2[<span class="number">0</span>] = <span class="string">"tuffy"</span>; <span class="comment">// 编译通过</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以通过push等方法，使数量超过</span></span><br><span class="line">type tupleArr3 = [string, number];</span><br><span class="line"><span class="keyword">let</span> tArr3: tupleArr3;</span><br><span class="line">tArr3 = [<span class="string">"tuffy"</span>, <span class="number">12</span>];</span><br><span class="line">tArr3.push(<span class="number">2019</span>); <span class="comment">// 编译通过</span></span><br><span class="line">tArr3.push(<span class="string">"shenzhen"</span>); <span class="comment">// 编译通过</span></span><br><span class="line">tArr2.push(<span class="literal">true</span>); <span class="comment">// 编译报错，只能push该元组各index类型的联合类型，意思是这里只能push的类型是“string|number”</span></span><br></pre></td></tr></table></figure>
<h2 id="十、类型断言"><a href="#十、类型断言" class="headerlink" title="十、类型断言"></a>十、类型断言</h2><p>可以手动指定一个值的类型。语法：&lt;类型&gt;值 或者 值 as 类型。（类型断言不是类型转换）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getLength</span>(<span class="params">data: string | number</span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ((<span class="xml"><span class="tag">&lt;<span class="name">string</span>&gt;</span>data).length) &#123; // 此处不加类型断言会编译报错，因为number没有length属性</span></span><br><span class="line">    return (&lt;string&gt;data).length; // 此处不加类型断言会编译报错，因为number没有length属性</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    return data.toString().length;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="十一、声明语句与声明文件"><a href="#十一、声明语句与声明文件" class="headerlink" title="十一、声明语句与声明文件"></a>十一、声明语句与声明文件</h2><h3 id="1-全局变量声明文件"><a href="#1-全局变量声明文件" class="headerlink" title="1. 全局变量声明文件"></a>1. 全局变量声明文件</h3><p>当我们使用 &lt;script>&lt;/script> 引入一个第三方库 jquery 时，可以直接使用 \$ 或者 jQuery，虽然使用上是正常的，但 ts 编译时会报错，表示没有找到这个变量，此时可以做一下类似声明 declare var jQuery: (selector: string): any; 来应对编译器的检查，使之知道 jQuery 是一个全局变量不必报错。声明本身只是一个对于编译器的变量及其类型的告知，并没有赋值之类的意义。<br>一个文件的声明语句可以放在对应声明文件中，一般以 .d.ts 后缀结尾。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">declare <span class="keyword">var</span> str: string</span><br><span class="line">declare <span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params">s: string</span>): <span class="title">string</span></span></span><br><span class="line"><span class="function"><span class="title">declare</span> <span class="title">enum</span> <span class="title">Num</span></span>&#123;&#125;</span><br><span class="line">declare <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;&#125;</span><br><span class="line">declare namespace Obj &#123;&#125;</span><br><span class="line">interface IProp &#123;&#125; <span class="comment">// interface 和 type 前不需要 declare 也可以表示声明</span></span><br><span class="line">type IType = &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>声明是可以进行合并的，但它们需是同一类型，比如都是 string，都是对象等。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">declare <span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params">s: string</span>): <span class="title">string</span></span></span><br><span class="line"><span class="function"><span class="title">declare</span> <span class="title">namespace</span> <span class="title">fun</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> settting: any</span><br><span class="line">&#125;</span><br><span class="line">fun(<span class="string">'321'</span>);</span><br><span class="line">fun.settting = <span class="string">'123'</span>;</span><br></pre></td></tr></table></figure>
<p>下面的则会报错：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">declare <span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params">s: string</span>): <span class="title">string</span>;</span></span><br><span class="line"><span class="function"><span class="title">declare</span> <span class="title">var</span> <span class="title">fun</span>: <span class="title">string</span>; // 报错</span></span><br></pre></td></tr></table></figure>
<p>全局变量声明文件不能有 import 或者 export，不然将被视为一个包或者库，那么当该文件需要引入其他库的声明文件或者其他全局变量声明文件时，使用三斜线指令：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference types="jquery" /&gt; // types用来指明对某一个库的依赖</span></span><br><span class="line"><span class="comment">/// &lt;reference path="helloUtil.d.ts" /&gt; // path用来指明对其他文件的依赖</span></span><br></pre></td></tr></table></figure>
<h3 id="2-局部变量声明文件"><a href="#2-局部变量声明文件" class="headerlink" title="2. 局部变量声明文件"></a>2. 局部变量声明文件</h3><p>当 declare 前加上导出 export 时，此时该文件中变量不再是全局变量，而是需要相应文件中 import 才能应用的变量声明。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./types/hello.d.ts</span></span><br><span class="line"></span><br><span class="line">declare <span class="keyword">var</span> str: string</span><br><span class="line">declare <span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params">s: string</span>): <span class="title">string</span></span></span><br><span class="line"><span class="function"><span class="title">declare</span> <span class="title">enum</span> <span class="title">Num</span> </span>&#123; &#125;</span><br><span class="line">declare <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123; &#125;</span><br><span class="line">declare namespace Obj &#123; &#125;</span><br><span class="line">type IType = &#123;&#125;</span><br><span class="line"><span class="keyword">export</span> interface IProp &#123; &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./hello.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; IProp &#125; <span class="keyword">from</span> <span class="string">"./types/hello"</span>;</span><br><span class="line"><span class="keyword">let</span> prop: IProp = &#123;</span><br><span class="line">  <span class="comment">// 不报错</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">fun(<span class="string">"321"</span>); <span class="comment">// 报错</span></span><br><span class="line">fun.settting = <span class="string">"123"</span>;</span><br></pre></td></tr></table></figure>
<p>如果在局部变量声明文件中，某个变量希望被扩展成全局变量，可以使用下面方法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./types/hello.d.ts</span></span><br><span class="line">declare global &#123; <span class="keyword">var</span> num: number &#125;</span><br><span class="line">declare <span class="function"><span class="keyword">function</span> <span class="title">fun</span>(<span class="params">s: string</span>): <span class="title">string</span></span></span><br><span class="line"><span class="function"><span class="title">export</span> <span class="title">interface</span> <span class="title">IProp</span> </span>&#123; &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./hello.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; IProp &#125; <span class="keyword">from</span> <span class="string">"./types/hello"</span>;</span><br><span class="line"><span class="keyword">let</span> prop: IProp = &#123;</span><br><span class="line">  <span class="comment">// 不报错</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">fun(<span class="string">"321"</span>); <span class="comment">// 报错</span></span><br><span class="line">fun.settting = <span class="string">"123"</span>;</span><br><span class="line"></span><br><span class="line">num = <span class="number">123</span>; <span class="comment">// 不报错</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/15/正则表达式方法-exec-与-match/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="J.Y.">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="写字的地方">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/15/正则表达式方法-exec-与-match/" itemprop="url">正则表达式方法 exec 与 match</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-15T23:35:09+08:00">
                2019-10-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>exec 是一个 RegExp 方法，意思是它的执行是：regexp.exec(str);<br>match 是一个 String 方法，意思是它的执行是：str.match(regexp);</p>
<p>当不使用全局匹配时，两者可以得到相同的结果：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">"abc1+abc2+abc3"</span>;</span><br><span class="line"><span class="keyword">var</span> regexp1 = <span class="regexp">/(abc)\d/</span>;</span><br><span class="line"></span><br><span class="line">str.match(regexp1); <span class="comment">// (2)["abc1", "abc", index: 0, input: "abc1+abc2+abc3", groups: undefined...]</span></span><br><span class="line">regexp1.exec(str); <span class="comment">// (2)["abc1", "abc", index: 0, input: "abc1+abc2+abc3", groups: undefined...]</span></span><br></pre></td></tr></table></figure>
<p>因为非全局匹配，它们得到了完全一样的结果“abc1”：</p>
<p><img src="../images/reg-exp-not-g.png" alt="&#39;reg-exp-not-g&#39;"></p>
<p>当使用全局匹配时，两者的行为表现就不一致了：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">"abc1+abc2+abc3"</span>;</span><br><span class="line"><span class="keyword">var</span> regexp2 = <span class="regexp">/(abc)\d/g</span>;</span><br><span class="line"></span><br><span class="line">str.match(regexp2); <span class="comment">// (3) ["abc1", "abc2", "abc3"]</span></span><br><span class="line">regexp2.exec(str); <span class="comment">// (2) ["abc1", "abc", index: 0, input: "abc1+abc2+abc3", groups: undefined...]</span></span><br><span class="line">regexp2.exec(str); <span class="comment">// (2) ["abc2", "abc", index: 5, input: "abc1+abc2+abc3", groups: undefined...]</span></span><br><span class="line">regexp2.exec(str); <span class="comment">// (2) ["abc3", "abc", index: 10, input: "abc1+abc2+abc3", groups: undefined...]</span></span><br><span class="line">regexp2.exec(str); <span class="comment">// null</span></span><br><span class="line">regexp2.exec(str); <span class="comment">// (2) ["abc1", "abc", index: 0, input: "abc1+abc2+abc3", groups: undefined...]</span></span><br></pre></td></tr></table></figure>
<p>使用全局匹配时，match 方法会得到所有匹配项，并作为一个数组返回；<br>而 exec 方法每次只得到一个，每一次执行 exec 再接着往下找,直到找不到返回 null，之后再执行则再次从头匹配</p>
<p><img src="../images/reg-exp-has-g.png" alt="&#39;reg-exp-has-g&#39;"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">J.Y.</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">22</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">J.Y.</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  







<!-- LOCAL: You can save these files to your site and update links -->
    
        
        <link rel="stylesheet" href="https://aimingoo.github.io/gitmint/style/default.css">
        <script src="https://aimingoo.github.io/gitmint/dist/gitmint.browser.js"></script>
    
<!-- END LOCAL -->

    
      <style>
        a.gitment-editor-footer-tip { display: none; }
        .gitment-container.gitment-footer-container { display: none; }
      </style>
    

    







  





  

  

  

  
  

  

  

  

</body>
</html>
